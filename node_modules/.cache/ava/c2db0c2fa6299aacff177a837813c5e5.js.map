{"version":3,"sources":["tests/type-test.js"],"names":["test","require","sinon","proxyquire","typeFixtures","classFixtures","config","logging","db","sandbox","TypeStub","ClassStub","DateStub","hasMany","spy","RegionStub","belongsTo","DatacenterStub","DatacenterMainStub","UsersStub","TrafficStub","GbStub","CentralizedAnalysisStub","PdpStub","SauStub","ThStub","UthStub","UpdpStub","UsauStub","PdpSauStub","SauUsersStub","ThfcSauStub","ThfcPdpStub","classId","condArgs","where","clase","newType","tipo","nombre","newCondArgs","beforeEach","createSandbox","findOne","stub","withArgs","returns","Promise","resolve","findByClass","single","update","create","toJSON","setupDatabase","afterEach","restore","t","truthy","Type","true","called","calledTwice","calledWith","calledOnce","serial","type","createOrUpdate","deepEqual"],"mappings":"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","sourceRoot":"/var/www/html/planner-db","sourcesContent":["'use strict'\n\nconst test = require('ava')\nconst sinon = require('sinon')\nconst proxyquire = require('proxyquire')\n\nconst typeFixtures = require('./fixtures/type')\nconst classFixtures = require('./fixtures/class')\n\nlet config = {\n  logging: function () {}\n}\n\nlet db = null\nlet sandbox = null\nlet TypeStub = null\nlet ClassStub = null\n\n// general\nlet DateStub = {\n  hasMany: sinon.spy()\n}\nlet RegionStub = {\n  belongsTo: sinon.spy(),\n  hasMany: sinon.spy()\n}\nlet DatacenterStub = {\n  belongsTo: sinon.spy(),\n  hasMany: sinon.spy()\n}\nlet DatacenterMainStub = {\n  hasMany: sinon.spy()\n}\n\nlet UsersStub = {\n  belongsTo: sinon.spy()\n}\nlet TrafficStub = {\n  belongsTo: sinon.spy()\n}\nlet GbStub = {\n  belongsTo: sinon.spy()\n}\nlet CentralizedAnalysisStub = {\n  belongsTo: sinon.spy()\n}\n\n// core-ps\nlet PdpStub = {\n  belongsTo: sinon.spy()\n}\nlet SauStub = {\n  belongsTo: sinon.spy()\n}\nlet ThStub = {\n  belongsTo: sinon.spy()\n}\n\n// u2000\nlet UthStub = {\n  belongsTo: sinon.spy()\n}\nlet UpdpStub = {\n  belongsTo: sinon.spy()\n}\nlet UsauStub = {\n  belongsTo: sinon.spy()\n}\n\n// ratios\nlet PdpSauStub = {\n  belongsTo: sinon.spy()\n}\nlet SauUsersStub = {\n  belongsTo: sinon.spy()\n}\nlet ThfcSauStub = {\n  belongsTo: sinon.spy()\n}\nlet ThfcPdpStub = {\n  belongsTo: sinon.spy()\n}\n\nlet classId = 1\nlet condArgs = {\n  where: {\n    clase: classId\n  }\n}\n\nlet newType = {\n  tipo: 9,\n  nombre: 'no-existes'\n}\nlet newCondArgs = {\n  where: {\n    tipo: newType.tipo\n  }\n}\n\ntest.beforeEach(async () => {\n  sandbox = sinon.createSandbox()\n  TypeStub = {\n    hasMany: sandbox.spy(),\n    belongsTo: sandbox.spy()\n  }\n  ClassStub = {\n    hasMany: sandbox.spy()\n  }\n\n  // Class#Model findOne Stub\n  ClassStub.findOne = sandbox.stub()\n  ClassStub.findOne.withArgs(condArgs).returns(Promise.resolve(classFixtures.findByClass(classId)))\n  // Type#Model findOne Stub\n  TypeStub.findOne = sandbox.stub()\n  TypeStub.findOne.withArgs({where: {tipo: typeFixtures.single.tipo}}).returns(Promise.resolve(typeFixtures.single))\n  // Type#Model update Stub\n  TypeStub.update = sandbox.stub()\n  TypeStub.update.withArgs(typeFixtures.single, condArgs).returns(Promise.resolve(typeFixtures.single))\n  // Type#Model create Stub\n  TypeStub.create = sandbox.stub()\n  TypeStub.create.withArgs(newType).returns(Promise.resolve({\n    toJSON () {\n      return newType\n    }\n  }))\n\n  const setupDatabase = proxyquire('../', {\n    './models/general/users': () => UsersStub,\n    './models/general/traffic': () => TrafficStub,\n    './models/general/gb': () => GbStub,\n    './models/general/centralized_analysis': () => CentralizedAnalysisStub,\n\n    './models/general/date': () => DateStub,\n    './models/general/type': () => TypeStub,\n    './models/general/class': () => ClassStub,\n    './models/general/region': () => RegionStub,\n    './models/general/datacenter': () => DatacenterStub,\n    './models/general/datacenter_main': () => DatacenterMainStub,\n\n    './models/core-ps/pdp': () => PdpStub,\n    './models/core-ps/sau': () => SauStub,\n    './models/core-ps/th': () => ThStub,\n\n    './models/u2000/th': () => UthStub,\n    './models/u2000/pdp': () => UpdpStub,\n    './models/u2000/sau': () => UsauStub,\n\n    './models/ratios/pdp_ sau': () => PdpSauStub,\n    './models/ratios/sau_users': () => SauUsersStub,\n    './models/ratios/thfc_sau': () => ThfcSauStub,\n    './models/ratios/thfc_pdp': () => ThfcPdpStub\n  })\n\n  db = await setupDatabase(config)\n})\n\ntest.afterEach(() => {\n  sandbox && sandbox.restore()\n})\n\ntest('Type', t => {\n  t.truthy(db.Type, 'Type service should exist')\n})\n\ntest('Setup', t => {\n  t.true(TypeStub.hasMany.called, 'TypeModel.hasMany was execute')\n  t.true(TypeStub.hasMany.calledTwice, 'hasMany should be called twice')\n  t.true(TypeStub.hasMany.calledWith(UsersStub), 'Argument needs should be the UsersModel')\n  t.true(TypeStub.hasMany.calledWith(TrafficStub), 'Argument needs should be the TrafficModel')\n  t.true(TypeStub.belongsTo.called, 'TypeModel.belongsTo was executed')\n  t.true(TypeStub.belongsTo.calledOnce, 'belongsTo should be called once')\n  t.true(TypeStub.belongsTo.calledWith(ClassStub), 'TypeModel.belongsTo should be called with ClassStub args')\n})\n\ntest.serial('Type#createOrUpdate - exist', async t => {\n  const type = await db.Type.createOrUpdate(typeFixtures.single, classId)\n  \n  t.true(ClassStub.findOne.called, 'ClassModel.findOne was execute')\n  t.true(ClassStub.findOne.calledOnce,' findOne should be called once')\n  t.true(ClassStub.findOne.calledWith(condArgs), 'findOne should be called with condArgs args')\n  t.true(TypeStub.findOne.called, 'TypeModel.findOne was execute')\n  t.true(TypeStub.findOne.calledOnce, 'findOne should be called once')\n  t.true(TypeStub.findOne.calledWith({ where: { tipo: typeFixtures.single.tipo} }), 'findOne should be called with tipo Args')\n  t.true(TypeStub.update.called, 'update should be called')\n  t.true(TypeStub.update.calledOnce, 'update should be called once')\n  t.true(TypeStub.update.calledWith(typeFixtures.single, { where: { tipo: typeFixtures.single.tipo} } ), 'update should be called with single, cond Args')\n\n\n  t.deepEqual(type, typeFixtures.single, 'should be the same')\n})\n\n\ntest.serial('Type#createOrUpdate - new', async t => {\n  const type = await db.Type.createOrUpdate(newType, classId)\n\n  t.true(TypeStub.findOne.called, 'findOne should be called')\n  t.true(TypeStub.findOne.calledOnce, 'findOne should be called once')\n  t.true(TypeStub.findOne.calledWith(newCondArgs), 'findOne should be called with newCond Args')\n  t.true(TypeStub.create.called, 'create should be called')\n  t.true(TypeStub.create.calledOnce, 'create should be called once')\n  t.true(TypeStub.create.calledWith(newType), 'create should be called with newClass args')\n\n  t.deepEqual(type, newType, 'should be the same')\n})"]}