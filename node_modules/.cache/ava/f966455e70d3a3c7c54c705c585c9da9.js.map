{"version":3,"sources":["tests/region-test.js"],"names":["test","require","sinon","proxyquire","datacenterFixtures","regionFixtures","config","logging","db","sandbox","DatacenterStub","RegionStub","DateStub","hasMany","spy","TypeStub","belongsTo","ClassStub","DatacenterMainStub","UsersStub","TrafficStub","GbStub","CentralizedAnalysisStub","PdpStub","SauStub","ThStub","UthStub","UpdpStub","UsauStub","PdpSauStub","SauUsersStub","ThfcSauStub","ThfcPdpStub","datacenterId","condDatacenterArgs","where","datacenter","newDatacenterId","condNewDatacenter","regionId","single","region","condRegionArgs","newRegion","id","nombre","beforeEach","createSandbox","findOne","stub","withArgs","returns","Promise","resolve","update","create","toJSON","findAll","setupDatabase","afterEach","restore","t","truthy","Region","true","called","callCount","calledWith","calledOnce","serial","createOrUpdate","calledTwice","deepEqual","findByDatacenterMain"],"mappings":"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","sourceRoot":"/var/www/html/planner-db","sourcesContent":["'use strict'\n\nconst test = require('ava')\nconst sinon = require('sinon')\nconst proxyquire = require('proxyquire')\n\nconst datacenterFixtures = require('./fixtures/region')\nconst regionFixtures = require('./fixtures/region')\n\nlet config = {\n  logging: function () {}\n}\n\nlet db = null\nlet sandbox = null\nlet DatacenterStub = null\nlet RegionStub = null\n\n// general\nlet DateStub = {\n  hasMany: sinon.spy()\n}\nlet TypeStub = {\n  belongsTo: sinon.spy(),\n  hasMany: sinon.spy()\n}\nlet ClassStub = {\n  hasMany: sinon.spy()\n}\nlet DatacenterMainStub = {\n  hasMany: sinon.spy()\n}\n\nlet UsersStub = {\n  belongsTo: sinon.spy()\n}\nlet TrafficStub = {\n  belongsTo: sinon.spy()\n}\nlet GbStub = {\n  belongsTo: sinon.spy()\n}\nlet CentralizedAnalysisStub = {\n  belongsTo: sinon.spy()\n}\n\n// core-ps\nlet PdpStub = {\n  belongsTo: sinon.spy()\n}\nlet SauStub = {\n  belongsTo: sinon.spy()\n}\nlet ThStub = {\n  belongsTo: sinon.spy()\n}\n\n// u2000\nlet UthStub = {\n  belongsTo: sinon.spy()\n}\nlet UpdpStub = {\n  belongsTo: sinon.spy()\n}\nlet UsauStub = {\n  belongsTo: sinon.spy()\n}\n\n// ratios\nlet PdpSauStub = {\n  belongsTo: sinon.spy()\n}\nlet SauUsersStub = {\n  belongsTo: sinon.spy()\n}\nlet ThfcSauStub = {\n  belongsTo: sinon.spy()\n}\nlet ThfcPdpStub = {\n  belongsTo: sinon.spy()\n}\n\nlet datacenterId = 1\nlet condDatacenterArgs = {\n  where: {\n    datacenter: datacenterId\n  }\n}\n\nlet newDatacenterId = 5\nlet condNewDatacenter = {\n  where: { datacenterId: newDatacenterId }\n}\n\nlet regionId = regionFixtures.single.region\nlet condRegionArgs = {\n  where: {\n    region: regionId\n  }\n}\n\nlet newRegion = {\n  id: 8,\n  nombre: 'lalolalocura',\n  datacenterId\n}\n\ntest.beforeEach(async () => {\n  sandbox = sinon.createSandbox()\n  RegionStub = {\n    hasMany: sandbox.spy(),\n    belongsTo: sandbox.spy()\n  }\n  DatacenterStub = {\n    hasMany: sandbox.spy(),\n    belongsTo: sandbox.spy()\n  }\n\n    // Class#Model findOne Stub\n    DatacenterStub.findOne = sandbox.stub()\n    DatacenterStub.findOne.withArgs(condDatacenterArgs).returns(Promise.resolve(datacenterFixtures.single))\n  //   DatacenterStub.findOne.withArgs(condNewDatacenter).returns(Promise.resolve(datacenterFixtures.findByDatacenterMain(newDatacenterId)))\n    // Type#Model findOne Stub\n    RegionStub.findOne = sandbox.stub()\n    RegionStub.findOne.withArgs(condRegionArgs).returns(Promise.resolve(regionFixtures.single))\n    // Type#Model update Stub\n    RegionStub.update = sandbox.stub()\n    RegionStub.update.withArgs(regionFixtures.single, condRegionArgs).returns(Promise.resolve(regionFixtures.single))\n    // Type#Model create Stub\n    RegionStub.create = sandbox.stub()\n    RegionStub.create.withArgs(newRegion).returns(Promise.resolve({\n      toJSON () {\n        return newRegion\n      }\n    }))\n    // Class#Model findAll Stub\n    RegionStub.findAll = sandbox.stub()\n    RegionStub.findAll.withArgs().returns(Promise.resolve(regionFixtures.findAll))\n  //   RegionStub.findAll.withArgs({\n  //     attributes: ['region', 'nombre'],\n  //     group: ['region'],\n  //     include: [{\n  //       attributes: [],\n  //       model: DatacenterStub,\n  //       where: {\n  //         datacenterId: datacenterId\n  //       }\n  //     }],\n  //     raw: true\n  //   }).returns(Promise.resolve(regionFixtures.findByDatacenterMainId(datacenterId)))\n\n  const setupDatabase = proxyquire('../', {\n    './models/general/users': () => UsersStub,\n    './models/general/traffic': () => TrafficStub,\n    './models/general/gb': () => GbStub,\n    './models/general/centralized_analysis': () => CentralizedAnalysisStub,\n\n    './models/general/date': () => DateStub,\n    './models/general/type': () => TypeStub,\n    './models/general/class': () => ClassStub,\n    './models/general/region': () => RegionStub,\n    './models/general/datacenter': () => DatacenterStub,\n    './models/general/datacenter_main': () => DatacenterMainStub,\n\n    './models/core-ps/pdp': () => PdpStub,\n    './models/core-ps/sau': () => SauStub,\n    './models/core-ps/th': () => ThStub,\n\n    './models/u2000/th': () => UthStub,\n    './models/u2000/pdp': () => UpdpStub,\n    './models/u2000/sau': () => UsauStub,\n\n    './models/ratios/pdp_ sau': () => PdpSauStub,\n    './models/ratios/sau_users': () => SauUsersStub,\n    './models/ratios/thfc_sau': () => ThfcSauStub,\n    './models/ratios/thfc_pdp': () => ThfcPdpStub\n  })\n\n  db = await setupDatabase(config)\n})\n\ntest.afterEach(() => {\n  sandbox && sandbox.restore()\n})\n\ntest('Region', t => {\n  t.truthy(db.Region, 'Region service should exist')\n})\n\ntest('Setup', t => {\n  t.true(RegionStub.hasMany.called, 'DatacenterModel.hasMany was execute')\n  t.true(RegionStub.hasMany.callCount === 6, 'hasMany should be called once')\n  t.true(RegionStub.hasMany.calledWith(UsersStub), 'Argument needs should be the UsersModel args')\n  t.true(RegionStub.hasMany.calledWith(TrafficStub), 'Argument needs should be the TrafficModel args')\n  t.true(RegionStub.hasMany.calledWith(GbStub), 'Argument needs should be the GbModel args')\n  t.true(RegionStub.hasMany.calledWith(ThStub), 'Argument needs should be the ThModel args')\n  t.true(RegionStub.hasMany.calledWith(SauStub), 'Argument needs should be the SauModel args')\n  t.true(RegionStub.hasMany.calledWith(PdpStub), 'Argument needs should be the PdpModel args')\n  t.true(RegionStub.belongsTo.called, 'DatacenterModel.belongsTo was executed')\n  t.true(RegionStub.belongsTo.calledOnce, 'belongsTo should be called once')\n  t.true(RegionStub.belongsTo.calledWith(DatacenterStub), 'RegionModel.belongsTo should be called with DatacenterMainModel args')\n})\n\ntest.serial('Region#createOrUpdate - exist', async t => {\n  const region = await db.Region.createOrUpdate(regionFixtures.single, datacenterId)\n\n  t.true(DatacenterStub.findOne.called, 'DatacenterMainModel.findOne was execute')\n  t.true(DatacenterStub.findOne.calledOnce, 'DatacenterMain#findOne should be called once')\n  t.true(DatacenterStub.findOne.calledWith(condDatacenterArgs), 'findOne should be called with condArgs args')\n  t.true(RegionStub.findOne.called, 'Region.findOne was execute')\n  t.true(RegionStub.findOne.calledTwice, 'Region#findOne should be called once')\n  t.true(RegionStub.findOne.calledWith(condRegionArgs), 'findOne should be called with tipo Args')\n  t.true(RegionStub.update.called, 'update should be called')\n  t.true(RegionStub.update.calledOnce, 'update should be called once')\n  t.true(RegionStub.update.calledWith(regionFixtures.single, condRegionArgs), 'update should be called with single, cond Args')\n\n  t.deepEqual(region, regionFixtures.single, 'should be the same')\n})\n\ntest.serial('Region#createOrUpdate - new', async t => {\n  const region = await db.Region.createOrUpdate(newRegion, datacenterId)\n\n  t.true(DatacenterStub.findOne.called, 'DatacenterMainModel.findOne was execute')\n  t.true(DatacenterStub.findOne.calledOnce, 'DatacenterMain#findOne should be called once')\n  t.true(DatacenterStub.findOne.calledWith(condDatacenterArgs), 'findOne should be called with condArgs args')\n  t.true(RegionStub.findOne.called, 'Region.findOne was execute')\n  t.true(RegionStub.findOne.calledOnce, 'Region#findOne should be called once')\n  t.true(RegionStub.findOne.calledWith({ where: { region: newRegion.region } }), 'findOne should be called with newDatacenter Args')\n  t.true(RegionStub.create.calledOnce, 'create should be called once')\n  t.true(RegionStub.create.calledWith(newRegion), 'create should be called with newDatacenter args')\n\n  t.deepEqual(region, newRegion, 'should be the same')\n})\n\ntest.serial('Region#createOrUpdate - datacenterMain no exist', async t => {\n  const region = await db.Region.createOrUpdate(newRegion, newDatacenterId)\n\n  t.true(DatacenterStub.findOne.called, 'DatacenterMain.findOne was execute')\n  t.true(DatacenterStub.findOne.calledOnce, ' findOne should be called once')\n  t.true(DatacenterStub.findOne.calledWith(condNewDatacenter), 'findOne should be called with condNewDatacenter args')\n\n  t.deepEqual(region, datacenterFixtures.findByDatacenterMain(newDatacenterId), 'should be the same')\n})\n\n// test.serial('Region#findAll', async t => {\n//   let datacenters = await db.Region.findAll()\n\n//   t.true(RegionStub.findAll.called, 'findAll should be called')\n//   t.true(RegionStub.findAll.calledOnce, 'findAll should be called once')\n//   t.true(RegionStub.findAll.calledWith(), 'findAll should be called without any args')\n\n//   t.deepEqual(datacenters, regionFixtures.findAll, 'Classes should be the same')\n// })\n\n// test.serial('Region#findByDatacenterMain', async t => {\n//   let datacenters = await db.Region.findByDatacenterMain(datacenterId)\n//   t.true(RegionStub.findAll.called, 'findAll should be called')\n//   t.true(RegionStub.findAll.calledOnce, 'findAll should be called once')\n\n//   t.deepEqual(datacenters, regionFixtures.findByDatacenterMainId(datacenterId), 'should be the same')\n// })\n"]}